var l=(a,e,r)=>a>=e&&a<=r,f=a=>!!(a!==" "&&l(Number(a),0,9)),p=a=>a.length===0,d=a=>{let e=Number(a);return isNaN(e)?{}:{Ok:e}};var b={0:"+",1:"-",2:"*",3:"/",4:"(",5:")",6:a=>a??"0"},v={6:0,0:1,1:1,2:2,3:2,4:3,5:3};var h={SIMPLE:[{eng:"Unknown error",jpn:"\u672A\u77E5\u306E\u30A8\u30E9\u30FC"},{eng:"Input error",jpn:"\u5165\u529B\u30A8\u30E9\u30FC"},{eng:"Syntax error",jpn:"\u69CB\u6587\u30A8\u30E9\u30FC"},{eng:"Calculate error",jpn:"\u8A08\u7B97\u30A8\u30E9\u30FC"}],MEDIUM:[{eng:"Unknown error",jpn:"\u672A\u77E5\u306E\u30A8\u30E9\u30FC\u3067\u3059"},{eng:"Input is empty",jpn:"\u5F0F\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"},{eng:"Input is too long",jpn:"\u5F0F\u304C\u9577\u3059\u304E\u307E\u3059"},{eng:"Invalid token",jpn:"\u7121\u52B9\u306A\u6587\u5B57\u304C\u3042\u308A\u307E\u3059"},{eng:"Invalid number",jpn:"\u7121\u52B9\u306A\u6570\u5024\u304C\u3042\u308A\u307E\u3059"},{eng:"Invalid operator",jpn:"\u7121\u52B9\u306A\u6F14\u7B97\u5B50\u304C\u3042\u308A\u307E\u3059"},{eng:"() is not found",jpn:"\u5BFE\u5FDC\u3059\u308B () \u304C\u3042\u308A\u307E\u305B\u3093"},{eng:"Zero divide",jpn:"\u30BC\u30ED\u9664\u7B97\u306F\u3067\u304D\u307E\u305B\u3093"},{eng:"Invalid Result",jpn:"\u8A08\u7B97\u7D50\u679C\u304C\u7121\u52B9\u3067\u3059"}],FULL:[{eng:"Unknown error",jpn:"\u672A\u77E5\u306E\u30A8\u30E9\u30FC\u3067\u3059"},{eng:"Input is empty",jpn:"\u5F0F\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"},{eng:"Input is too long",jpn:"\u5F0F\u304C\u9577\u3059\u304E\u307E\u3059"},{eng:"Invalid token",jpn:"\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token at start",jpn:"\u5148\u982D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token at end",jpn:"\u672B\u5C3E\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token before number",jpn:"\u6570\u5024\u306E\u524D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token before operator",jpn:"\u6F14\u7B97\u5B50\u306E\u524D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token before (",jpn:"( \u306E\u524D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid number",jpn:"\u3053\u306E\u6570\u5024\u306F\u7121\u52B9\u3067\u3059"},{eng:"Invalid operator",jpn:"\u3053\u306E\u6F14\u7B97\u5B50\u306F\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093"},{eng:"() is not found",jpn:"\u5BFE\u5FDC\u3059\u308B () \u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093"},{eng:"Zero divide",jpn:"\u30BC\u30ED\u9664\u7B97\u306F\u3067\u304D\u307E\u305B\u3093"},{eng:"Result is not a number",jpn:"\u8A08\u7B97\u7D50\u679C\u304C\u6570\u5024\u3067\u306F\u3042\u308A\u307E\u305B\u3093"}],MINIMUM:[{eng:"Error",jpn:"\u30A8\u30E9\u30FC"}]};function M(a,e,r){let t=i=>{switch(i){case 1:return h.SIMPLE;case 2:return h.MEDIUM;case 3:return h.FULL;case 0:return h.MINIMUM;default:return h.MINIMUM}},n=(i,c)=>{switch(i){case 0:return c.eng;case 1:return c.jpn;default:return h.MINIMUM[0].eng}},o=t(r),s=a<o.length?a:0;return n(e,o[s])}var u=class{constructor(e,r){this.type=e;let t=b[e];this.str=typeof t=="function"?t(r):t,this.order=v[e]}str;order;match(e){return this.type===e}matchAll(e){return new Set(e).has(this.type)}isSign(){return this.matchAll([0,1])}isBeforeSign(){return this.matchAll([0,1,2,3,4])}isArithmetic(){return this.matchAll([0,1,2,3])}isParenthesis(){return this.matchAll([4,5])}};var m=class{hasError;errorNumber;errorFunction;messageLevel;messageLang;constructor(e,r){let t=()=>{switch(e){case 1:case 2:case 3:return e;default:return 0}},n=()=>{switch(r){case 0:case 1:return r;default:return 0}};this.hasError=!1,this.errorNumber=0,this.errorFunction="",this.messageLevel=t(),this.messageLang=n()}getMessageText(e){return M(e,this.messageLang,this.messageLevel)}generateMessage(e,r,t){let n=this.getMessageText(e),o=()=>{switch(this.messageLang){case 0:return this.messageLevel===0?"Error":"Error ";case 1:return"\u30A8\u30E9\u30FC"}},s=r?`${this.errorNumber}: ${n}`:`: ${n}`,i=t?` [function ${this.errorFunction}()]`:"";return`${o()}${s}${i}`}getSimpleMessage(){let e=()=>{let r=this.errorNumber;return l(r,1,2)?1:l(r,3,11)?2:l(r,12,13)?3:0};return this.generateMessage(e(),!1,!1)}getMediumMessage(){let e=()=>{let r=this.errorNumber;return l(r,3,8)?3:l(r,1,12)?r:0};return this.generateMessage(e(),!0,!1)}getFullMessage(){return this.generateMessage(this.errorNumber,!0,!0)}getMinimumMessage(){return this.getMessageText(0)}outputError(){switch(this.messageLevel){case 1:return this.getSimpleMessage();case 2:return this.getMediumMessage();case 3:return this.getFullMessage();case 0:return this.getMinimumMessage();default:return this.getMinimumMessage()}}setError(e,r){this.errorNumber=e,this.errorFunction=r,this.hasError=!0}};var g=class{formula;formulaRPN;result;error;maxFormulaLength;constructor(e,r,t){this.formula=[],this.formulaRPN=[],this.result="",this.error=new m(e,r),this.maxFormulaLength=t}run(e){return this.scanInput(e).formatSign().checkSyntax().convertRPN().calculateRPN().removeTrailingZero(),this.error.hasError?this.error.outputError():this.result}catchError(e,r){return this.error.setError(e,r),this}scanInput(e){let r="scanInput",t=[];if(e.length<1)return this.catchError(1,r);if(e.length>this.maxFormulaLength)return this.catchError(2,r);for(let n of e){if(f(n)||n==="."){t.push(n);continue}switch(p(t)||this.formula.push(new u(6,t.join(""))),n){case"+":this.formula.push(new u(0));break;case"-":this.formula.push(new u(1));break;case"*":this.formula.push(new u(2));break;case"/":this.formula.push(new u(3));break;case"(":this.formula.push(new u(4));break;case")":this.formula.push(new u(5));break;case`
`:case" ":break;default:return this.catchError(3,r)}t.length=0}return t.length!==0&&this.formula.push(new u(6,t.join(""))),this}formatSign(){let e=this.formula;if(this.error.hasError||e.length<2)return this;let r=(t,n,o)=>{e.splice(t-1,2,new u(4),new u(6,"0"),n,o,new u(5))};for(let t=0;t<e.length;++t){if(t===1&&e[0].isSign()&&e[1].match(6)){r(t,e[0],e[1]),t=4;continue}t>=2&&e[t].match(6)&&e[t-1].isSign()&&e[t-2].isBeforeSign()&&(r(t,e[t-1],e[t]),t+=3)}return this}checkSyntax(){let e="checkSyntax",r=this.formula,t=0;if(this.error.hasError)return this;if(r.length===1){let n=r[0];return n.match(6)?isNaN(Number(n.str))?this.catchError(9,e):(this.result=n.str,this):this.catchError(3,e)}for(let[n,o]of r.entries()){if(n===0){switch(o.type){case 2:case 3:case 5:return this.catchError(4,e);case 4:++t;break}continue}if(n===r.length-1&&(o.isArithmetic()||o.match(4)))return this.catchError(5,e);let s=r[n-1];switch(o.type){case 6:switch(s.type){case 5:return this.catchError(6,e);case 6:return this.catchError(10,e)}break;case 0:case 1:case 2:case 3:if(s.isArithmetic())return this.catchError(7,e);break;case 4:if(++t,s.matchAll([6,5]))return this.catchError(8,e);break;case 5:if(--t,s.match(4))return this.catchError(3,e);break}}return!this.error.hasError&&t!==0?this.catchError(11,e):this}convertRPN(){let e="convertRPN",r=[];if(this.error.hasError)return this;if(p(this.result)){for(let t of this.formula)switch(t.type){case 6:this.formulaRPN.push(t);break;case 4:r.push(t);break;case 5:let n=!1;for(;!n;){if(p(r))return this.catchError(11,e);r.at(-1).match(4)?(r.pop(),n=!0):this.formulaRPN.push(r.pop())}break;case 0:case 1:case 2:case 3:for(;!p(r)&&r.at(-1).isArithmetic()&&t.order<=r.at(-1).order;)this.formulaRPN.push(r.pop());r.push(t);break}for(;!p(r);){let t=r.pop();if(t.isParenthesis())return this.catchError(11,e);this.formulaRPN.push(t)}}return this}calculateRPN(){let e="calculateRPN",r=[],t=(s,i,c)=>{switch(c.type){case 0:return{Ok:i+s};case 1:return{Ok:i-s};case 2:return{Ok:i*s};case 3:return s===0?{Err:12}:{Ok:i/s};default:return{Err:10}}},n=s=>{let c=Math.abs(s).toString(),I=c.indexOf(".")+1;return c.includes(".")?c.length-I:0},o=(s,i)=>n(s)>i?s.toFixed(i):s.toString();if(this.error.hasError)return this;if(p(this.result)){for(let s of this.formulaRPN)if(s.isArithmetic()){let i=t(r.pop(),r.pop(),s);if(i.Ok!==void 0){if(r.push(i.Ok),isNaN(i.Ok))return this.catchError(13,e)}else if(i.Err!==void 0)return this.catchError(i.Err,e)}else if(s.match(6)){let i=d(s.str);if(i.Ok!==void 0)r.push(i.Ok);else return this.catchError(9,e)}this.result=o(r.pop(),10)}return this}removeTrailingZero(){let e=this.result;if(this.error.hasError)return this;if(e.includes(".")){let r=e.split("");for(;r.at(-1)==="0";)r.pop();r.at(-1)==="."&&r.pop(),this.result=r.join("")}return this}};var Z=(a,e,r,t)=>new g(e,r,t).run(a);export{Z as calculate};
//# sourceMappingURL=calculator.js.map
