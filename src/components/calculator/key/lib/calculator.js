var l=(a,e,t)=>a>=e&&a<=t,d=a=>!!(a!==" "&&l(Number(a),0,9)),c=a=>a.length===0,b=a=>{let e=Number(a);return isNaN(e)?{}:{Ok:e}};var f={0:"+",1:"-",2:"*",3:"/",4:"(",5:")",6:a=>a??"0"},v=Object.fromEntries(Object.entries(f).filter(([a,e])=>typeof e=="string").map(([a,e])=>[e,Number(a)])),M={6:0,0:1,1:1,2:2,3:2,4:3,5:3};var h={SIMPLE:[{eng:"Unknown error",jpn:"\u672A\u77E5\u306E\u30A8\u30E9\u30FC"},{eng:"Input error",jpn:"\u5165\u529B\u30A8\u30E9\u30FC"},{eng:"Syntax error",jpn:"\u69CB\u6587\u30A8\u30E9\u30FC"},{eng:"Calculate error",jpn:"\u8A08\u7B97\u30A8\u30E9\u30FC"}],MEDIUM:[{eng:"Unknown error",jpn:"\u672A\u77E5\u306E\u30A8\u30E9\u30FC\u3067\u3059"},{eng:"Input is empty",jpn:"\u5F0F\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"},{eng:"Input is too long",jpn:"\u5F0F\u304C\u9577\u3059\u304E\u307E\u3059"},{eng:"Invalid token",jpn:"\u7121\u52B9\u306A\u6587\u5B57\u304C\u3042\u308A\u307E\u3059"},{eng:"Invalid number",jpn:"\u7121\u52B9\u306A\u6570\u5024\u304C\u3042\u308A\u307E\u3059"},{eng:"Invalid operator",jpn:"\u7121\u52B9\u306A\u6F14\u7B97\u5B50\u304C\u3042\u308A\u307E\u3059"},{eng:"() is not found",jpn:"\u5BFE\u5FDC\u3059\u308B () \u304C\u3042\u308A\u307E\u305B\u3093"},{eng:"Zero divide",jpn:"\u30BC\u30ED\u9664\u7B97\u306F\u3067\u304D\u307E\u305B\u3093"},{eng:"Invalid Result",jpn:"\u8A08\u7B97\u7D50\u679C\u304C\u7121\u52B9\u3067\u3059"}],FULL:[{eng:"Unknown error",jpn:"\u672A\u77E5\u306E\u30A8\u30E9\u30FC\u3067\u3059"},{eng:"Input is empty",jpn:"\u5F0F\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"},{eng:"Input is too long",jpn:"\u5F0F\u304C\u9577\u3059\u304E\u307E\u3059"},{eng:"Invalid token",jpn:"\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token at start",jpn:"\u5148\u982D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token at end",jpn:"\u672B\u5C3E\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token before number",jpn:"\u6570\u5024\u306E\u524D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token before operator",jpn:"\u6F14\u7B97\u5B50\u306E\u524D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid token before (",jpn:"( \u306E\u524D\u306B\u7121\u52B9\u306A\u6587\u5B57\u304C\u5165\u3063\u3066\u3044\u307E\u3059"},{eng:"Invalid number",jpn:"\u3053\u306E\u6570\u5024\u306F\u7121\u52B9\u3067\u3059"},{eng:"Invalid operator",jpn:"\u3053\u306E\u6F14\u7B97\u5B50\u306F\u4F7F\u7528\u3067\u304D\u307E\u305B\u3093"},{eng:"() is not found",jpn:"\u5BFE\u5FDC\u3059\u308B () \u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093"},{eng:"Zero divide",jpn:"\u30BC\u30ED\u9664\u7B97\u306F\u3067\u304D\u307E\u305B\u3093"},{eng:"Result is not a number",jpn:"\u8A08\u7B97\u7D50\u679C\u304C\u6570\u5024\u3067\u306F\u3042\u308A\u307E\u305B\u3093"}],MINIMUM:[{eng:"Error",jpn:"\u30A8\u30E9\u30FC"}]};function I(a,e,t){let r=i=>{switch(i){case 1:return h.SIMPLE;case 2:return h.MEDIUM;case 3:return h.FULL;case 0:return h.MINIMUM;default:return h.MINIMUM}},s=(i,u)=>{switch(i){case 0:return u.eng;case 1:return u.jpn;default:return h.MINIMUM[0].eng}},o=r(t),n=a<o.length?a:0;return s(e,o[n])}var p=class{constructor(e,t){this.type=e;let r=f[e];this.str=typeof r=="function"?r(t):r,this.order=M[e]}str;order;match(e){return this.type===e}matchAll(e){return new Set(e).has(this.type)}isSign(){return this.matchAll([0,1])}isBeforeSign(){return this.matchAll([0,1,2,3,4])}isArithmetic(){return this.matchAll([0,1,2,3])}isParenthesis(){return this.matchAll([4,5])}};var m=class{hasError;errorNumber;errorFunction;messageLevel;messageLang;constructor(e,t){let r=()=>{switch(e){case 1:case 2:case 3:return e;default:return 0}},s=()=>{switch(t){case 0:case 1:return t;default:return 0}};this.hasError=!1,this.errorNumber=0,this.errorFunction="",this.messageLevel=r(),this.messageLang=s()}getMessageText(e){return I(e,this.messageLang,this.messageLevel)}generateMessage(e,t,r){let s=this.getMessageText(e),o=()=>{switch(this.messageLang){case 0:return this.messageLevel===0?"Error":"Error ";case 1:return"\u30A8\u30E9\u30FC"}},n=t?`${this.errorNumber}: ${s}`:`: ${s}`,i=r?` [function ${this.errorFunction}()]`:"";return`${o()}${n}${i}`}getSimpleMessage(){let e=()=>{let t=this.errorNumber;return l(t,1,2)?1:l(t,3,11)?2:l(t,12,13)?3:0};return this.generateMessage(e(),!1,!1)}getMediumMessage(){let e=()=>{let t=this.errorNumber;return l(t,3,8)?3:l(t,1,12)?t:0};return this.generateMessage(e(),!0,!1)}getFullMessage(){return this.generateMessage(this.errorNumber,!0,!0)}getMinimumMessage(){return this.getMessageText(0)}outputError(){switch(this.messageLevel){case 1:return this.getSimpleMessage();case 2:return this.getMediumMessage();case 3:return this.getFullMessage();case 0:return this.getMinimumMessage();default:return this.getMinimumMessage()}}setError(e,t){this.errorNumber=e,this.errorFunction=t,this.hasError=!0}};var g=class{formula;formulaRPN;result;error;maxFormulaLength;constructor(e,t,r){this.formula=[],this.formulaRPN=[],this.result="",this.error=new m(e,t),this.maxFormulaLength=r}run(e){return this.scanInput(e).checkSyntax().convertRPN().calculateRPN().removeTrailingZero(),this.error.hasError?this.error.outputError():this.result}catchError(e,t){return this.error.setError(e,t),this}scanInput(e){let t="scanInput",r=[],s=null;if(e.length<1)return this.catchError(1,t);if(e.length>this.maxFormulaLength)return this.catchError(2,t);for(let o of e){if(d(o)||o==="."){r.push(o);continue}if(c(r)||(this.formula.push(new p(6,r.join(""))),s=this.formula.at(-1)),(o==="+"||o==="-")&&(s===null||s.isBeforeSign())){r.push(o);continue}if(r.length=0,!(o===`
`||o===" ")){let n=v[o];if(n!==void 0)this.formula.push(new p(n));else return this.catchError(3,t)}s=this.formula.at(-1)}return r.length!==0&&this.formula.push(new p(6,r.join(""))),this}checkSyntax(){let e="checkSyntax",t=this.formula,r=0;if(this.error.hasError)return this;if(t.length===1){let s=t[0];return s.match(6)?isNaN(Number(s.str))?this.catchError(9,e):(this.result=s.str,this):this.catchError(3,e)}for(let[s,o]of t.entries()){if(s===0){switch(o.type){case 2:case 3:case 5:return this.catchError(4,e);case 4:++r;break}continue}if(s===t.length-1&&(o.isArithmetic()||o.match(4)))return this.catchError(5,e);let n=t[s-1];switch(o.type){case 6:switch(n.type){case 5:return this.catchError(6,e);case 6:return this.catchError(10,e)}break;case 0:case 1:case 2:case 3:if(n.isArithmetic())return this.catchError(7,e);break;case 4:if(++r,n.matchAll([6,5]))return this.catchError(8,e);break;case 5:if(--r,n.match(4))return this.catchError(3,e);break}}return!this.error.hasError&&r!==0?this.catchError(11,e):this}convertRPN(){let e="convertRPN",t=[];if(this.error.hasError)return this;if(c(this.result)){for(let r of this.formula)switch(r.type){case 6:this.formulaRPN.push(r);break;case 4:t.push(r);break;case 5:let s=!1;for(;!s;){if(c(t))return this.catchError(11,e);t.at(-1).match(4)?(t.pop(),s=!0):this.formulaRPN.push(t.pop())}break;case 0:case 1:case 2:case 3:for(;!c(t)&&t.at(-1).isArithmetic()&&r.order<=t.at(-1).order;)this.formulaRPN.push(t.pop());t.push(r);break}for(;!c(t);){let r=t.pop();if(r.isParenthesis())return this.catchError(11,e);this.formulaRPN.push(r)}}return this}calculateRPN(){let e="calculateRPN",t=[],r=(n,i,u)=>{switch(u.type){case 0:return{Ok:i+n};case 1:return{Ok:i-n};case 2:return{Ok:i*n};case 3:return n===0?{Err:12}:{Ok:i/n};default:return{Err:10}}},s=n=>{let u=Math.abs(n).toString(),k=u.indexOf(".")+1;return u.includes(".")?u.length-k:0},o=(n,i)=>s(n)>i?n.toFixed(i):n.toString();if(this.error.hasError)return this;if(c(this.result)){for(let n of this.formulaRPN)if(n.isArithmetic()){let i=r(t.pop(),t.pop(),n);if(i.Ok!==void 0){if(t.push(i.Ok),isNaN(i.Ok))return this.catchError(13,e)}else if(i.Err!==void 0)return this.catchError(i.Err,e)}else if(n.match(6)){let i=b(n.str);if(i.Ok!==void 0)t.push(i.Ok);else return this.catchError(9,e)}this.result=o(t.pop(),10)}return this}removeTrailingZero(){let e=this.result;if(this.error.hasError)return this;if(e.includes(".")){let t=e.split("");for(;t.at(-1)==="0";)t.pop();t.at(-1)==="."&&t.pop(),this.result=t.join("")}return this}};var Z=(a,e,t,r)=>new g(e,t,r).run(a);export{Z as calculate};
//# sourceMappingURL=calculator.js.map
